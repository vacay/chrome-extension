var app=angular.module("vacay",["ngRoute","ngAnimate"]);app.config(["$httpProvider",function(a){a.interceptors.push(["$rootScope","$q","$window","api",function(a,b,c,d){return{request:function(a){return c.localStorage.token&&-1!==a.url.indexOf(d)&&(a.params=a.params||{},a.params.token=c.localStorage.token),a||b.when(a)}}}])}]),app.controller("SigninCtrl",["$scope","Auth","$timeout",function(a,b,c){a.message=null,a.email=null,a.password=null,a.shake=!1,a.signin=function(){b.signin(a.email,a.password)},a.$on("auth:signin:message",function(b,d){a.message=d,a.shake=!0,c(function(){a.shake=!1},2e3)})}]),app.factory("Auth",["$http","User","$rootScope","api","$window",function(a,b,c,d,e){return{init:function(){a.get(d+"/me").success(function(a){b.init(a.data),c.$broadcast("auth:initialized"),analytics.track("init")}).error(function(){c.$broadcast("auth:initialized"),c.$broadcast("show:landing")})},signin:function(f,g){a.post(d+"/auth/signin",{email:f,password:g}).success(function(a){e.localStorage.token=a.token,b.init(a.data),analytics.track("signin")}).error(function(a){delete e.sessionStorage.token,c.$broadcast("auth:signin:message",a.data)})},signout:function(){delete e.localStorage.token,b.deauthenticate(),analytics.track("signout")}}}]),app.factory("Crate",["$http","api",function(a,b){return{create:function(c,d){a.post(b+"/vitamin/"+c+"/crate").success(function(a){d(null,a.data)}).error(function(a){d(a.data,null)})},destroy:function(c,d){a.delete(b+"/vitamin/"+c+"/crate").success(function(a){d(null,a.data)}).error(function(a){d(a.data,null)})}}}]),app.filter("duration",function(){return function(a){if(!a)return"";var b=parseInt(a,10),c=Math.floor(b/3600),d=Math.floor((b-3600*c)/60),e=b-3600*c-60*d;return 10>c&&(c="0"+c),10>d&&(d="0"+d),10>e&&(e="0"+e),c+":"+d+":"+e}}),app.run(["$rootScope","Auth",function(a,b){a.initialized=!1,a.authenticated=!1,a.username=null,a.$on("auth:initialized",function(){a.initialized=!0}),a.$on("user:authenticated",function(b,c){a.username=c,a.authenticated=!0,analytics.identify(c)}),a.$on("user:deauthenticated",function(){a.authenticated=!1,a.username=null}),a.signout=b.signout,b.init()}]),app.controller("PageCtrl",["$scope","Page",function(a,b){a.vitamins=null,a.page=null,a.loading=!0,chrome.tabs.getSelected(null,function(c){b.create(c.url,function(b,c){b&&console.error(b),a.page=c,a.loading=!1})})}]),app.factory("Page",["$rootScope","$http","api",function(a,b,c){return{create:function(a,d){b.post(c+"/page",{url:a}).success(function(a){d(null,a.data),analytics.track("page:create")}).error(function(a){d(a.data||"failed to load",null)})}}}]),app.directive("ngProgress",["$rootScope","$timeout","$interval",function(a,b,c){return{replace:!0,restrict:"E",scope:{loading:"=",value:"="},link:function(a,d){a.count=0;var e=0,f=!1,g=function(){f=!1,b(function(){d.children().css("opacity","0"),b(function(){a.count=0},200)},500)},h=function(){f=!0,b(function(){d.children().css("opacity","1")})},i=function(){h(),e=c(function(){if(isNaN(a.count))c.cancel(e),a.count=0,g();else{var b=100-a.count;a.count=a.count+.15*Math.pow(1-Math.sqrt(b),2)}},200)},j=function(){c.cancel(e),a.count=100,b(function(){g()},1e3)},k=function(a){f||h(),d.children().css("width",a+"%"),100===a&&g()};a.$watch("value",function(a){a&&k(a)}),a.$watch("count",function(a){a&&d.children().css("width",a+"%")}),a.$watch("loading",function(a,b){a===!0?i():a||b!==!0||j()})},template:'<div class="ngProgress-container"><div class="ngProgress"></div></div>'}}]),app.config(["$httpProvider",function(a){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]}]),app.factory("User",["$rootScope",function(a){return{id:null,username:null,data:null,authenticated:null,init:function(b){this.id=b.id,this.username=b.username,this.authenticated=!0,this.data=b,delete this.data.subscriptions,a.$broadcast("user:initialized"),a.$broadcast("user:subscriptions:update"),a.$broadcast("user:authenticated",b.username)},deauthenticate:function(){this.id=null,this.username=null,this.data=null,this.authenticated=!1,a.$broadcast("user:deauthenticated")}}}]),app.directive("vitamin",["Crate",function(a){return{restrict:"AE",templateUrl:function(a,b){return b.templateUrl||"/layouts/vitamin.html"},link:function(b){var c=function(){b.isCrated=!0,a.create(b.vitamin.id,function(a){a&&console.error(a)})},d=function(){b.isCrated=!1,a.destroy(b.vitamin.id,function(a){a&&console.error(a)})};b.isCrated=b.vitamin.crates.length?!0:!1,b.toggleCrate=function(){b.isCrated?d():c()}}}}]);var environment="production";"development"===environment?app.constant("api","http://localhost:8000/v1"):(app.constant("api","https://api.vacay.io/v1"),window.analytics.load("u32ikjebq3"),window.analytics.page()),angular.bootstrap(document,[app.name]);